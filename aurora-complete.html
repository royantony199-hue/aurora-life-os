<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora Life OS - Complete</title>
    <!-- Chart.js for mood visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #F5F7FA;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Ensure all interactive elements are clickable */
        button, input, select, .nav-item, .mood-emoji, .quick-reply, .calendar-day, .event-item {
            position: relative;
            z-index: 10;
            pointer-events: auto !important;
            cursor: pointer !important;
        }
        
        /* Main App Container */
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 430px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }
        
        /* Navigation */
        .nav-container {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 430px;
            max-width: 100%;
            background: white;
            border-top: 1px solid #E8E8E8;
            z-index: 100;
        }
        
        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 16px 12px;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #8C8C8C;
            font-size: 10px;
            font-weight: 500;
            text-decoration: none;
            position: relative;
            z-index: 101;
        }
        
        .nav-item:hover {
            background: #F5F7FA;
            transform: scale(1.05);
        }
        
        .nav-item.active {
            color: #4A90E2;
            background: #F0F9FF;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }
        
        /* Content Areas */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding-bottom: 80px;
        }
        
        .content.hidden {
            display: none;
        }
        
        /* Chat Interface */
        .chat-header {
            background: white;
            border-bottom: 1px solid #D9D9D9;
            padding: 12px 16px;
            display: flex;
            align-items: center;
        }
        
        .chat-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4A90E2, #722ED1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            margin-right: 12px;
        }
        
        .chat-info h1 {
            font-size: 16px;
            color: #262626;
            margin-bottom: 2px;
        }
        
        .chat-info p {
            font-size: 14px;
            color: #8C8C8C;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-height: calc(100vh - 200px);
        }
        
        .message {
            display: flex;
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-bubble {
            max-width: 280px;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .message.ai .message-bubble {
            background: #F5F7FA;
            color: #262626;
        }
        
        .message.user .message-bubble {
            background: #4A90E2;
            color: white;
        }
        
        /* Input Area */
        .chat-input-area {
            padding: 16px;
            background: white;
            border-top: 1px solid #E8E8E8;
        }
        
        .input-container {
            display: flex;
            align-items: center;
            background: #F5F7FA;
            border-radius: 24px;
            padding: 8px;
            gap: 8px;
        }
        
        .input-field {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            font-size: 14px;
            padding: 8px 12px;
        }
        
        .send-button {
            width: 40px;
            height: 40px;
            background: #4A90E2;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        /* Calendar Interface */
        .calendar-header {
            background: linear-gradient(135deg, #4A90E2, #722ED1);
            color: white;
            padding: 20px 16px;
            text-align: center;
        }
        
        .calendar-header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .nav-button {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            font-size: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .calendar-month {
            font-size: 18px;
            font-weight: 600;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #E8E8E8;
            margin: 0 16px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            background: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            position: relative;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .calendar-day:hover {
            background: #F0F9FF;
        }
        
        .calendar-day.today {
            background: #4A90E2;
            color: white;
        }
        
        .calendar-day.has-events::after {
            content: '';
            position: absolute;
            bottom: 4px;
            width: 6px;
            height: 6px;
            background: #52C41A;
            border-radius: 50%;
        }
        
        .day-header {
            background: #F5F7FA;
            font-weight: 600;
            color: #8C8C8C;
            font-size: 12px;
        }
        
        /* Mood Interface */
        .mood-header {
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            color: white;
            padding: 20px 16px;
            text-align: center;
        }
        
        .mood-header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .mood-content {
            flex: 1;
            padding: 20px 16px;
            overflow-y: auto;
        }
        
        .mood-checkin {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        
        .mood-emojis {
            display: flex;
            justify-content: space-between;
            margin: 16px 0;
        }
        
        .mood-emoji {
            font-size: 32px;
            padding: 12px;
            border-radius: 50%;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .mood-emoji:hover {
            transform: scale(1.2);
            background: #F0F9FF;
        }
        
        .mood-emoji.selected {
            background: #4A90E2;
            transform: scale(1.1);
        }
        
        /* Goals Interface */
        .goals-header {
            background: linear-gradient(135deg, #52C41A, #73D13D);
            color: white;
            padding: 20px 16px;
            text-align: center;
        }
        
        .goals-header h1 {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .goals-content {
            flex: 1;
            padding: 20px 16px;
            overflow-y: auto;
        }
        
        .goal-item {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .goal-title {
            font-size: 16px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 8px;
        }
        
        .goal-progress {
            width: 100%;
            height: 8px;
            background: #F5F5F5;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }
        
        .goal-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #52C41A, #73D13D);
            transition: width 0.3s ease;
        }
        
        /* AI Calendar Panel */
        .ai-calendar-panel {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin: 16px;
            border: 1px solid #E8E8E8;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .ai-calendar-panel h3 {
            font-size: 16px;
            color: #262626;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .calendar-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .ai-btn {
            background: #4A90E2;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 80px;
        }
        
        .ai-btn:hover {
            background: #357ABD;
            transform: translateY(-1px);
        }
        
        .ai-btn.purple {
            background: #722ED1;
        }
        
        .ai-btn.purple:hover {
            background: #5A1E99;
        }
        
        .ai-btn.green {
            background: #52C41A;
        }
        
        .ai-btn.green:hover {
            background: #389E0D;
        }
        
        .ai-btn.red {
            background: #FF4D4F;
        }
        
        .ai-btn.red:hover {
            background: #D9363E;
        }
        
        .smart-event-form {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        .smart-event-form input {
            flex: 1;
            min-width: 150px;
            padding: 8px;
            border: 1px solid #D9D9D9;
            border-radius: 6px;
            font-size: 12px;
        }
        
        .smart-event-form select {
            padding: 8px;
            border: 1px solid #D9D9D9;
            border-radius: 6px;
            font-size: 12px;
        }
        
        .event-type-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }
        
        .event-type-btn {
            padding: 4px 8px;
            border: 1px solid;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            text-align: center;
            min-width: 60px;
        }
        
        .results-section {
            margin-top: 12px;
            padding: 12px;
            background: #FAFAFA;
            border-radius: 8px;
            font-size: 12px;
            min-height: 40px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .success { color: #52C41A; }
        .error { color: #FF4D4F; }
        .info { color: #4A90E2; }
        
        /* Event List */
        .events-list {
            margin-top: 16px;
        }
        
        .event-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid #4A90E2;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .event-item:hover {
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .event-item.goal-related {
            border-left-color: #52C41A;
        }
        
        .event-item.ai-scheduled {
            border-left-color: #722ED1;
        }
        
        .event-time {
            font-size: 11px;
            color: #8C8C8C;
            margin-bottom: 4px;
        }
        
        .event-title {
            font-size: 14px;
            font-weight: 500;
            color: #262626;
            margin-bottom: 2px;
        }
        
        .event-meta {
            font-size: 10px;
            color: #8C8C8C;
        }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4A90E2;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
            max-width: 300px;
        }
        
        .toast.success { background: #52C41A; }
        .toast.error { background: #FF4D4F; }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4A90E2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Chat Interface -->
        <div id="chat-content" class="content">
            <div class="chat-header">
                <div class="chat-avatar">A</div>
                <div class="chat-info">
                    <h1>Aurora</h1>
                    <p>Your AI Life Coach</p>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    <div class="message-bubble">
                        Welcome! I'm Aurora, your AI life coach. I can help you manage your calendar, schedule optimal times for your goals, and organize your entire day for maximum productivity. Try switching to the Calendar tab to see the AI scheduling features!
                    </div>
                </div>
            </div>
            
            <div class="chat-input-area">
                <div class="input-container">
                    <input type="text" class="input-field" placeholder="Message Aurora..." id="messageInput">
                    <button class="send-button" id="send-button" onclick="sendMessage()">‚Üí</button>
                </div>
            </div>
        </div>

        <!-- Mood Tracker -->
        <div id="mood-content" class="content hidden">
            <div class="mood-header">
                <h1>üíó Mood Tracker</h1>
                <p>How are you feeling today?</p>
            </div>
            
            <div class="mood-content">
                <div class="mood-checkin">
                    <h3>Daily Check-in</h3>
                    <div>
                        <label>Mood Level</label>
                        <div class="mood-emojis">
                            <span class="mood-emoji" onclick="setMood(1)">üò¢</span>
                            <span class="mood-emoji" onclick="setMood(3)">üòï</span>
                            <span class="mood-emoji" onclick="setMood(5)">üòê</span>
                            <span class="mood-emoji selected" onclick="setMood(7)">üòä</span>
                            <span class="mood-emoji" onclick="setMood(9)">üòÑ</span>
                        </div>
                    </div>
                    <button class="ai-btn green" onclick="saveMood()" style="width: 100%; margin-top: 16px;">Save Mood Check-in</button>
                </div>
            </div>
        </div>

        <!-- Calendar Interface -->
        <div id="calendar-content" class="content hidden">
            <div class="calendar-header">
                <div class="calendar-nav">
                    <button class="nav-button" onclick="navigateMonth(-1)">‚Äπ</button>
                    <div class="calendar-month" id="currentMonth">January 2024</div>
                    <button class="nav-button" onclick="navigateMonth(1)">‚Ä∫</button>
                </div>
                <p>Smart AI scheduling and calendar management</p>
            </div>
            
            <div class="calendar-grid" id="calendarGrid">
                <!-- Calendar will be generated here -->
            </div>
            
            <!-- AI Calendar Management -->
            <div class="ai-calendar-panel">
                <h3>ü§ñ AI Calendar Assistant</h3>
                
                <div class="calendar-buttons">
                    <button class="ai-btn" onclick="generateHourlySchedule()">üìÖ Today's Plan</button>
                    <button class="ai-btn purple" onclick="optimizeWeek()">üìä Optimize Week</button>
                    <button class="ai-btn green" onclick="scheduleGoalTime()">üéØ Schedule Goals</button>
                </div>
                
                <div class="smart-event-form">
                    <input type="text" id="smart-event-title" placeholder="What do you want to work on?" value="Review quarterly goals">
                    <select id="smart-event-duration">
                        <option value="30">30 min</option>
                        <option value="60" selected>1 hour</option>
                        <option value="90">1.5 hours</option>
                        <option value="120">2 hours</option>
                    </select>
                    <button class="ai-btn green" onclick="createSmartEvent()">AI Schedule</button>
                </div>
                
                <div class="event-type-buttons">
                    <button class="event-type-btn" data-type="goal_work" onclick="setEventType('goal_work')" style="background: #F0F9FF; color: #1890FF; border-color: #BAE7FF;">Goal Work</button>
                    <button class="event-type-btn" data-type="deep_work" onclick="setEventType('deep_work')" style="background: #F6FFED; color: #52C41A; border-color: #B7EB8F;">Deep Work</button>
                    <button class="event-type-btn" data-type="meeting" onclick="setEventType('meeting')" style="background: #FFF7E6; color: #FA8C16; border-color: #FFD591;">Meeting</button>
                    <button class="event-type-btn" data-type="learning" onclick="setEventType('learning')" style="background: #F9F0FF; color: #722ED1; border-color: #D3ADF7;">Learning</button>
                </div>
                
                <!-- Calendar Management Actions -->
                <div class="calendar-buttons">
                    <button class="ai-btn" onclick="loadCalendarEvents()">üîÑ Refresh Events</button>
                    <button class="ai-btn red" onclick="clearAllEvents()">üóëÔ∏è Clear All</button>
                </div>
                
                <div class="results-section" id="calendar-results">
                    <p class="info">üéØ AI Calendar system ready! Try scheduling an event or generating today's plan.</p>
                </div>
            </div>
            
            <!-- Today's Events -->
            <div class="events-list" id="todaysEvents">
                <h4 style="margin: 16px; color: #262626;">Today's Schedule</h4>
                <!-- Events will be loaded here -->
            </div>
        </div>

        <!-- Goals Interface -->
        <div id="goals-content" class="content hidden">
            <div class="goals-header">
                <h1>üéØ Goals Dashboard</h1>
                <p>Track your progress and achieve your dreams</p>
            </div>
            
            <div class="goals-content">
                <div class="goal-item">
                    <div class="goal-title">Complete Q1 Business Plan</div>
                    <div class="goal-progress">
                        <div class="goal-progress-bar" style="width: 75%;"></div>
                    </div>
                    <p style="font-size: 12px; color: #8C8C8C;">75% complete ‚Ä¢ Due March 31</p>
                </div>
                
                <div class="goal-item">
                    <div class="goal-title">Launch New Product Feature</div>
                    <div class="goal-progress">
                        <div class="goal-progress-bar" style="width: 45%;"></div>
                    </div>
                    <p style="font-size: 12px; color: #8C8C8C;">45% complete ‚Ä¢ Due February 15</p>
                </div>
                
                <button class="ai-btn green" onclick="scheduleGoalTime()" style="width: 100%; margin-top: 16px;">ü§ñ Auto-Schedule Goal Work Time</button>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-container">
        <div class="nav-items">
            <div class="nav-item active" data-tab="chat" onclick="switchTab('chat')">
                <div class="nav-icon">üí¨</div>
                Chat
            </div>
            <div class="nav-item" data-tab="mood" onclick="switchTab('mood')">
                <div class="nav-icon">üíó</div>
                Mood
            </div>
            <div class="nav-item" data-tab="calendar" onclick="switchTab('calendar')">
                <div class="nav-icon">üìÖ</div>
                Calendar
            </div>
            <div class="nav-item" data-tab="goals" onclick="switchTab('goals')">
                <div class="nav-icon">üéØ</div>
                Goals
            </div>
        </div>
    </div>

    <script>
        console.log('üåü Aurora Life OS Loading...');
        
        const backendUrl = 'http://127.0.0.1:8000';
        let selectedEventType = 'task';
        let currentDate = new Date();
        let currentMood = 7;
        let calendarEvents = [];
        
        // Ensure DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ DOM Content Loaded');
            
            // Initialize calendar
            generateCalendar();
            loadCalendarEvents();
            
            // Focus on input
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.focus();
            }
            
            // Test message
            setTimeout(() => {
                showCalendarResult('üöÄ Aurora Life OS loaded successfully! All AI calendar features are ready.', 'success');
            }, 1000);
        });
        
        // Navigation
        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            // Hide all content
            document.querySelectorAll('.content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected content
            const targetContent = document.getElementById(`${tabName}-content`);
            if (targetContent) {
                targetContent.classList.remove('hidden');
                
                // Special initialization for calendar tab
                if (tabName === 'calendar') {
                    generateCalendar();
                    loadCalendarEvents();
                }
            }
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            const activeItem = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            showToast(`üì± Switched to ${tabName} tab`, 'info');
        }
        
        // Calendar Generation
        function generateCalendar() {
            const grid = document.getElementById('calendarGrid');
            const monthElement = document.getElementById('currentMonth');
            
            if (!grid || !monthElement) return;
            
            // Update month display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];
            monthElement.textContent = `${monthNames[currentDate.getMonth()]} ${currentDate.getFullYear()}`;
            
            // Clear grid
            grid.innerHTML = '';
            
            // Day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'calendar-day day-header';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            // Get first day of month and number of days
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = firstDay.getDay();
            const daysInMonth = lastDay.getDate();
            
            // Previous month days
            const prevMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0);
            for (let i = startDate - 1; i >= 0; i--) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.style.color = '#BFBFBF';
                dayElement.textContent = prevMonth.getDate() - i;
                grid.appendChild(dayElement);
            }
            
            // Current month days
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                dayElement.dataset.date = day;
                
                // Check if today
                if (currentDate.getFullYear() === today.getFullYear() &&
                    currentDate.getMonth() === today.getMonth() &&
                    day === today.getDate()) {
                    dayElement.classList.add('today');
                }
                
                // Check for events
                const dayEvents = calendarEvents.filter(event => {
                    const eventDate = new Date(event.start_time);
                    return eventDate.getDate() === day &&
                           eventDate.getMonth() === currentDate.getMonth() &&
                           eventDate.getFullYear() === currentDate.getFullYear();
                });
                
                if (dayEvents.length > 0) {
                    dayElement.classList.add('has-events');
                }
                
                dayElement.onclick = () => selectDate(day);
                grid.appendChild(dayElement);
            }
            
            // Next month days
            const remainingCells = 42 - (startDate + daysInMonth);
            for (let day = 1; day <= remainingCells; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.style.color = '#BFBFBF';
                dayElement.textContent = day;
                grid.appendChild(dayElement);
            }
        }
        
        function navigateMonth(direction) {
            currentDate.setMonth(currentDate.getMonth() + direction);
            generateCalendar();
        }
        
        function selectDate(day) {
            const selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
            showCalendarResult(`üìÖ Selected date: ${selectedDate.toDateString()}`, 'info');
            
            // Show events for this day
            displayDayEvents(selectedDate);
        }
        
        function displayDayEvents(date) {
            const dayEvents = calendarEvents.filter(event => {
                const eventDate = new Date(event.start_time);
                return eventDate.toDateString() === date.toDateString();
            });
            
            const eventsContainer = document.getElementById('todaysEvents');
            if (!eventsContainer) return;
            
            eventsContainer.innerHTML = `<h4 style="margin: 16px; color: #262626;">Events for ${date.toDateString()}</h4>`;
            
            if (dayEvents.length === 0) {
                eventsContainer.innerHTML += `
                    <div style="text-align: center; padding: 20px; color: #8C8C8C;">
                        <p>No events scheduled</p>
                        <button class="ai-btn" onclick="generateHourlySchedule()" style="margin-top: 8px;">Generate AI Schedule</button>
                    </div>
                `;
                return;
            }
            
            dayEvents.forEach(event => {
                const eventDiv = document.createElement('div');
                eventDiv.className = `event-item ${event.contributes_to_goal ? 'goal-related' : ''} ${event.auto_scheduled ? 'ai-scheduled' : ''}`;
                
                const startTime = new Date(event.start_time);
                const timeStr = startTime.toLocaleTimeString('en-US', { 
                    hour: 'numeric', 
                    minute: '2-digit',
                    hour12: true 
                });
                
                eventDiv.innerHTML = `
                    <div class="event-time">${timeStr}</div>
                    <div class="event-title">${event.title}</div>
                    <div class="event-meta">
                        ${event.event_type} ${event.contributes_to_goal ? '‚Ä¢ Goal-related' : ''} ${event.auto_scheduled ? '‚Ä¢ AI-scheduled' : ''}
                    </div>
                `;
                
                eventDiv.onclick = () => editEvent(event);
                eventsContainer.appendChild(eventDiv);
            });
        }
        
        function editEvent(event) {
            showCalendarResult(`‚úèÔ∏è Editing event: ${event.title}`, 'info');
            
            // Show edit options
            const options = [
                { text: 'Reschedule', action: () => rescheduleEvent(event) },
                { text: 'Delete', action: () => deleteEvent(event) },
                { text: 'Duplicate', action: () => duplicateEvent(event) }
            ];
            
            let optionsHtml = options.map(opt => 
                `<button class="ai-btn" onclick="${opt.action.name}(${JSON.stringify(event).replace(/"/g, '&quot;')})" style="margin: 4px;">${opt.text}</button>`
            ).join('');
            
            showCalendarResult(`Event Options: ${optionsHtml}`, 'info');
        }
        
        async function rescheduleEvent(event) {
            showCalendarResult('ü§ñ AI is finding the best time to reschedule...', 'info');
            
            try {
                const response = await fetch(`${backendUrl}/api/ai-calendar/smart-update/${event.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        // Let AI find new optimal time
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    showCalendarResult('‚úÖ Event rescheduled successfully', 'success');
                    loadCalendarEvents();
                } else {
                    showCalendarResult(`‚ùå Failed to reschedule: ${result.error}`, 'error');
                }
            } catch (error) {
                showCalendarResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function deleteEvent(event) {
            if (!confirm(`Delete "${event.title}"?`)) return;
            
            try {
                const response = await fetch(`${backendUrl}/api/ai-calendar/smart-delete/${event.id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                if (result.success) {
                    showCalendarResult('‚úÖ Event deleted successfully', 'success');
                    if (result.recommendations && result.recommendations.length > 0) {
                        showCalendarResult(`üí° Suggestion: ${result.recommendations[0]}`, 'info');
                    }
                    loadCalendarEvents();
                } else {
                    showCalendarResult(`‚ùå Failed to delete event`, 'error');
                }
            } catch (error) {
                showCalendarResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function duplicateEvent(event) {
            try {
                const response = await fetch(`${backendUrl}/api/ai-calendar/smart-create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: `${event.title} (Copy)`,
                        description: event.description,
                        duration_minutes: Math.round((new Date(event.end_time) - new Date(event.start_time)) / 60000),
                        event_type: event.event_type,
                        priority: 'medium'
                    })
                });
                
                const result = await response.json();
                if (result.success) {
                    showCalendarResult('‚úÖ Event duplicated and scheduled optimally', 'success');
                    loadCalendarEvents();
                } else {
                    showCalendarResult(`‚ùå Failed to duplicate event`, 'error');
                }
            } catch (error) {
                showCalendarResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function clearAllEvents() {
            if (!confirm('Clear all calendar events? This cannot be undone.')) return;
            
            showCalendarResult('üóëÔ∏è Clearing all events...', 'info');
            
            // This would require a backend endpoint to clear all events
            // For now, just refresh
            setTimeout(() => {
                showCalendarResult('‚ÑπÔ∏è Feature coming soon - individual event deletion available', 'info');
            }, 1000);
        }
        
        // Chat Functions
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) {
                showToast('‚ö†Ô∏è Please enter a message', 'error');
                return;
            }
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const responses = [
                    "I can help you optimize your schedule! Try switching to the Calendar tab to see AI scheduling features.",
                    "That's a great goal! I can automatically schedule time blocks for your goals. Check the Calendar tab.",
                    "Let me help you plan that effectively. The AI Calendar system can find the optimal time slots.",
                    "Perfect! Use the Calendar tab to access AI scheduling, hourly planning, and goal-based time allocation."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessageToChat(randomResponse, 'ai');
            }, 1500);
        }
        
        function addMessageToChat(message, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = message;
            
            messageDiv.appendChild(bubble);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Mood Functions
        function setMood(level) {
            currentMood = level;
            document.querySelectorAll('.mood-emoji').forEach(emoji => emoji.classList.remove('selected'));
            document.querySelectorAll('.mood-emoji')[Math.floor((level-1)/2)].classList.add('selected');
            showToast(`Mood set to ${level}/10`, 'info');
        }
        
        function saveMood() {
            // This would save to backend
            showToast('‚úÖ Mood saved successfully', 'success');
        }
        
        // AI Calendar Functions
        function setEventType(type) {
            selectedEventType = type;
            showCalendarResult(`‚úÖ Event type set to: ${type}`, 'info');
            
            // Update button styles
            document.querySelectorAll('.event-type-btn').forEach(btn => {
                if (btn.dataset.type === type) {
                    btn.style.transform = 'scale(1.05)';
                    btn.style.fontWeight = 'bold';
                } else {
                    btn.style.transform = 'scale(1)';
                    btn.style.fontWeight = 'normal';
                }
            });
        }
        
        async function createSmartEvent() {
            const title = document.getElementById('smart-event-title').value.trim();
            const duration = parseInt(document.getElementById('smart-event-duration').value);
            
            if (!title) {
                showCalendarResult('‚ö†Ô∏è Please enter an event title', 'error');
                return;
            }
            
            showCalendarResult('ü§ñ AI is finding the perfect time slot...', 'info');
            
            try {
                const response = await fetch(`${backendUrl}/api/ai-calendar/smart-create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        duration_minutes: duration,
                        event_type: selectedEventType,
                        priority: 'medium'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const scheduledTime = new Date(result.scheduled_time).toLocaleString();
                    showCalendarResult(`‚úÖ "${title}" scheduled for ${scheduledTime}`, 'success');
                    
                    if (result.ai_insights?.reasoning) {
                        setTimeout(() => {
                            showCalendarResult(`üß† AI Reasoning: ${result.ai_insights.reasoning}`, 'info');
                        }, 2000);
                    }
                    
                    loadCalendarEvents();
                    generateCalendar();
                } else {
                    showCalendarResult(`‚ùå Failed to schedule: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Smart event error:', error);
                showCalendarResult(`‚ùå Connection error: ${error.message}`, 'error');
            }
        }
        
        async function generateHourlySchedule() {
            showCalendarResult('üìÖ Generating today\'s optimal schedule...', 'info');
            
            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(`${backendUrl}/api/ai-calendar/hourly-schedule`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date: today })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showCalendarResult(`‚úÖ Generated ${result.hourly_schedule.length}h schedule with ${result.productivity_score}% productivity!`, 'success');
                    showCalendarResult(`ü§ñ AI created ${result.ai_generated_slots} optimized time slots`, 'info');
                    
                    // Display schedule
                    displayHourlySchedule(result.hourly_schedule);
                } else {
                    showCalendarResult('‚ùå Failed to generate schedule', 'error');
                }
            } catch (error) {
                console.error('Hourly schedule error:', error);
                showCalendarResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function displayHourlySchedule(schedule) {
            const eventsContainer = document.getElementById('todaysEvents');
            eventsContainer.innerHTML = '<h4 style="margin: 16px; color: #262626;">Today\'s AI-Generated Schedule</h4>';
            
            schedule.forEach(slot => {
                const slotDiv = document.createElement('div');
                slotDiv.className = `event-item ${slot.goal_related ? 'goal-related' : ''} ${slot.ai_generated ? 'ai-scheduled' : ''}`;
                
                slotDiv.innerHTML = `
                    <div class="event-time">${slot.hour}</div>
                    <div class="event-title">${slot.title}</div>
                    <div class="event-meta">
                        ${slot.event_type} ${slot.goal_related ? '‚Ä¢ Goal-focused' : ''} ${slot.ai_generated ? '‚Ä¢ AI-optimized' : ''}
                        ${slot.description ? `‚Ä¢ ${slot.description}` : ''}
                    </div>
                `;
                
                eventsContainer.appendChild(slotDiv);
            });
        }
        
        async function optimizeWeek() {
            showCalendarResult('üìä Analyzing and optimizing your week...', 'info');
            
            try {
                const today = new Date();
                const monday = new Date(today.getFullYear(), today.getMonth(), today.getDate() - today.getDay() + 1);
                const weekStart = monday.toISOString().split('T')[0];
                
                const response = await fetch(`${backendUrl}/api/ai-calendar/weekly-optimize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ week_start_date: weekStart })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const goalPercentage = result.current_analysis.goal_percentage.toFixed(1);
                    showCalendarResult(`‚úÖ Week analyzed! ${goalPercentage}% goal-focused time`, 'success');
                    showCalendarResult(`üí° Found ${result.optimization_suggestions?.length || 0} optimization opportunities`, 'info');
                    
                    // Show optimization suggestions
                    if (result.optimization_suggestions && result.optimization_suggestions.length > 0) {
                        result.optimization_suggestions.forEach(suggestion => {
                            showCalendarResult(`üìã ${suggestion.title}: ${suggestion.description}`, 'info');
                        });
                    }
                } else {
                    showCalendarResult('‚ùå Failed to optimize week', 'error');
                }
            } catch (error) {
                console.error('Weekly optimization error:', error);
                showCalendarResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function scheduleGoalTime() {
            showCalendarResult('üéØ Auto-scheduling time blocks for your goals...', 'info');
            
            try {
                const response = await fetch(`${backendUrl}/api/ai-calendar/bulk-schedule-from-goals?days_ahead=7`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showCalendarResult(`‚úÖ Scheduled ${result.scheduled_events.length} goal sessions across ${result.goals_processed} goals`, 'success');
                    loadCalendarEvents();
                    generateCalendar();
                } else {
                    showCalendarResult(`‚ÑπÔ∏è ${result.message || 'No goals to schedule'}`, 'info');
                }
            } catch (error) {
                console.error('Goal scheduling error:', error);
                showCalendarResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function loadCalendarEvents() {
            try {
                const response = await fetch(`${backendUrl}/api/calendar/events?user_id=1&days_ahead=7`);
                const events = await response.json();
                calendarEvents = events || [];
                
                generateCalendar();
                
                // Show today's events
                displayDayEvents(new Date());
                
            } catch (error) {
                console.error('Load calendar events error:', error);
                showCalendarResult('‚ö†Ô∏è Could not load calendar events', 'error');
            }
        }
        
        // Utility Functions
        function showCalendarResult(message, type = 'info') {
            const resultsDiv = document.getElementById('calendar-results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            
            resultsDiv.innerHTML += `<p class="${className}">[${timestamp}] ${message}</p>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }
        
        // Enter key handling
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.id === 'messageInput') {
                e.preventDefault();
                sendMessage();
            }
        });
        
        console.log('üéØ Aurora Life OS Complete! All tabs and AI features ready.');
    </script>
</body>
</html>