<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora Life OS - Fixed</title>
    <!-- Chart.js for mood visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #F5F7FA;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Ensure all interactive elements are clickable */
        button, input, select, .nav-item, .mood-emoji, .quick-reply {
            position: relative;
            z-index: 10;
            pointer-events: auto !important;
            cursor: pointer !important;
        }
        
        /* Main App Container */
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            max-width: 430px;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }
        
        /* Navigation */
        .nav-container {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 430px;
            max-width: 100%;
            background: white;
            border-top: 1px solid #E8E8E8;
            z-index: 100;
        }
        
        .nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 8px 16px 12px;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #8C8C8C;
            font-size: 10px;
            font-weight: 500;
            text-decoration: none;
            position: relative;
            z-index: 101;
        }
        
        .nav-item:hover {
            background: #F5F7FA;
            transform: scale(1.05);
        }
        
        .nav-item.active {
            color: #4A90E2;
            background: #F0F9FF;
        }
        
        .nav-icon {
            font-size: 20px;
            margin-bottom: 2px;
        }
        
        /* Content Areas */
        .content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            padding-bottom: 80px;
        }
        
        .content.hidden {
            display: none;
        }
        
        /* Chat Interface */
        .chat-header {
            background: white;
            border-bottom: 1px solid #D9D9D9;
            padding: 12px 16px;
            display: flex;
            align-items: center;
        }
        
        .chat-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4A90E2, #722ED1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 500;
            margin-right: 12px;
        }
        
        .chat-info h1 {
            font-size: 16px;
            color: #262626;
            margin-bottom: 2px;
        }
        
        .chat-info p {
            font-size: 14px;
            color: #8C8C8C;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-height: calc(100vh - 200px);
        }
        
        .message {
            display: flex;
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-bubble {
            max-width: 280px;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .message.ai .message-bubble {
            background: #F5F7FA;
            color: #262626;
        }
        
        .message.user .message-bubble {
            background: #4A90E2;
            color: white;
        }
        
        /* Input Area */
        .chat-input-area {
            padding: 16px;
            background: white;
            border-top: 1px solid #E8E8E8;
        }
        
        .input-container {
            display: flex;
            align-items: center;
            background: #F5F7FA;
            border-radius: 24px;
            padding: 8px;
            gap: 8px;
        }
        
        .input-field {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            font-size: 14px;
            padding: 8px 12px;
        }
        
        .send-button {
            width: 40px;
            height: 40px;
            background: #4A90E2;
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        /* AI Calendar Panel */
        .ai-calendar-panel {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin: 16px;
            border: 1px solid #E8E8E8;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .ai-calendar-panel h3 {
            font-size: 16px;
            color: #262626;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .calendar-buttons {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .ai-btn {
            background: #4A90E2;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .ai-btn:hover {
            background: #357ABD;
            transform: translateY(-1px);
        }
        
        .ai-btn.purple {
            background: #722ED1;
        }
        
        .ai-btn.purple:hover {
            background: #5A1E99;
        }
        
        .ai-btn.green {
            background: #52C41A;
        }
        
        .ai-btn.green:hover {
            background: #389E0D;
        }
        
        .smart-event-form {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .smart-event-form input {
            flex: 1;
            padding: 8px;
            border: 1px solid #D9D9D9;
            border-radius: 6px;
            font-size: 12px;
        }
        
        .smart-event-form select {
            padding: 8px;
            border: 1px solid #D9D9D9;
            border-radius: 6px;
            font-size: 12px;
        }
        
        .event-type-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .event-type-btn {
            padding: 4px 8px;
            border: 1px solid;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .results-section {
            margin-top: 12px;
            padding: 12px;
            background: #FAFAFA;
            border-radius: 8px;
            font-size: 12px;
            min-height: 40px;
        }
        
        .success { color: #52C41A; }
        .error { color: #FF4D4F; }
        .info { color: #4A90E2; }
        
        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4A90E2;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 14px;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        .toast.success { background: #52C41A; }
        .toast.error { background: #FF4D4F; }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #4A90E2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Chat Interface -->
        <div id="chat-content" class="content">
            <div class="chat-header">
                <div class="chat-avatar">A</div>
                <div class="chat-info">
                    <h1>Aurora</h1>
                    <p>Your AI Life Coach</p>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message ai">
                    <div class="message-bubble">
                        Welcome! I'm Aurora, your AI life coach. I'm here to help you achieve your goals and optimize your daily schedule. Try asking me about your goals or click one of the buttons below to test the new AI Calendar features!
                    </div>
                </div>
            </div>
            
            <div class="chat-input-area">
                <div class="input-container">
                    <input type="text" class="input-field" placeholder="Message Aurora..." id="messageInput">
                    <button class="send-button" id="send-button" onclick="sendMessage()">→</button>
                </div>
            </div>
            
            <!-- AI Calendar Test Panel -->
            <div class="ai-calendar-panel">
                <h3>🤖 AI Calendar Assistant</h3>
                
                <div class="calendar-buttons">
                    <button class="ai-btn" onclick="generateHourlySchedule()">📅 Today's Plan</button>
                    <button class="ai-btn purple" onclick="optimizeWeek()">📊 Optimize Week</button>
                    <button class="ai-btn green" onclick="scheduleGoalTime()">🎯 Schedule Goals</button>
                </div>
                
                <div class="smart-event-form">
                    <input type="text" id="smart-event-title" placeholder="What do you want to work on?" value="Review project deliverables">
                    <select id="smart-event-duration">
                        <option value="30">30 min</option>
                        <option value="60" selected>1 hour</option>
                        <option value="120">2 hours</option>
                    </select>
                    <button class="ai-btn green" onclick="createSmartEvent()">AI Schedule</button>
                </div>
                
                <div class="event-type-buttons">
                    <button class="event-type-btn" data-type="goal_work" onclick="setEventType('goal_work')" style="background: #F0F9FF; color: #1890FF; border-color: #BAE7FF;">Goal Work</button>
                    <button class="event-type-btn" data-type="deep_work" onclick="setEventType('deep_work')" style="background: #F6FFED; color: #52C41A; border-color: #B7EB8F;">Deep Work</button>
                    <button class="event-type-btn" data-type="meeting" onclick="setEventType('meeting')" style="background: #FFF7E6; color: #FA8C16; border-color: #FFD591;">Meeting</button>
                </div>
                
                <div class="results-section" id="ai-results">
                    <p class="info">🎯 Click any button above to test the AI Calendar system!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-container">
        <div class="nav-items">
            <div class="nav-item active" data-tab="chat" onclick="switchTab('chat')">
                <div class="nav-icon">💬</div>
                Chat
            </div>
            <div class="nav-item" data-tab="mood" onclick="switchTab('mood')">
                <div class="nav-icon">💗</div>
                Mood
            </div>
            <div class="nav-item" data-tab="calendar" onclick="switchTab('calendar')">
                <div class="nav-icon">📅</div>
                Calendar
            </div>
            <div class="nav-item" data-tab="goals" onclick="switchTab('goals')">
                <div class="nav-icon">🎯</div>
                Goals
            </div>
        </div>
    </div>

    <script>
        console.log('🌟 Aurora Life OS Loading...');
        
        const backendUrl = 'http://127.0.0.1:8000';
        let selectedEventType = 'task';
        
        // Ensure DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ DOM Content Loaded');
            
            // Test basic interaction
            setTimeout(() => {
                showResult('🚀 Aurora Life OS loaded successfully! All buttons should be clickable.', 'success');
            }, 1000);
            
            // Focus on input
            const messageInput = document.getElementById('messageInput');
            if (messageInput) {
                messageInput.focus();
            }
        });
        
        // Navigation
        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            showResult(`📱 Switched to ${tabName} tab`, 'info');
            
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
        }
        
        // Chat Functions
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message) {
                showResult('⚠️ Please enter a message', 'error');
                return;
            }
            
            // Add user message to chat
            addMessageToChat(message, 'user');
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                const responses = [
                    "I understand you want to optimize your schedule. Let me help you with that!",
                    "That's a great goal! The AI Calendar system can help you plan this effectively.",
                    "I can help you break that down into manageable time blocks. Try the AI scheduling features above!",
                    "Perfect! Use the 'Today's Plan' button to get an optimized schedule for today."
                ];
                const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                addMessageToChat(randomResponse, 'ai');
            }, 1500);
            
            showResult('💬 Message sent successfully', 'success');
        }
        
        function addMessageToChat(message, type) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            const bubble = document.createElement('div');
            bubble.className = 'message-bubble';
            bubble.textContent = message;
            
            messageDiv.appendChild(bubble);
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // AI Calendar Functions
        function setEventType(type) {
            selectedEventType = type;
            showResult(`✅ Event type set to: ${type}`, 'info');
            
            // Update button styles
            document.querySelectorAll('.event-type-btn').forEach(btn => {
                if (btn.dataset.type === type) {
                    btn.style.transform = 'scale(1.05)';
                    btn.style.fontWeight = 'bold';
                } else {
                    btn.style.transform = 'scale(1)';
                    btn.style.fontWeight = 'normal';
                }
            });
        }
        
        async function createSmartEvent() {
            const title = document.getElementById('smart-event-title').value.trim();
            const duration = parseInt(document.getElementById('smart-event-duration').value);
            
            if (!title) {
                showResult('⚠️ Please enter an event title', 'error');
                return;
            }
            
            showResult('🤖 Creating smart event...', 'info');
            
            try {
                const response = await fetch(`${backendUrl}/api/ai-calendar/smart-create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        duration_minutes: duration,
                        event_type: selectedEventType,
                        priority: 'medium'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const scheduledTime = new Date(result.scheduled_time).toLocaleString();
                    showResult(`✅ "${title}" scheduled for ${scheduledTime}`, 'success');
                    
                    if (result.ai_insights?.reasoning) {
                        setTimeout(() => {
                            showResult(`🧠 AI Reasoning: ${result.ai_insights.reasoning}`, 'info');
                        }, 2000);
                    }
                } else {
                    showResult(`❌ Failed to schedule: ${result.error}`, 'error');
                }
            } catch (error) {
                console.error('Smart event error:', error);
                showResult(`❌ Connection error: ${error.message}`, 'error');
                showResult('💡 Make sure backend is running on localhost:8000', 'info');
            }
        }
        
        async function generateHourlySchedule() {
            showResult('📅 Generating today\'s optimal schedule...', 'info');
            
            try {
                const today = new Date().toISOString().split('T')[0];
                const response = await fetch(`${backendUrl}/api/ai-calendar/hourly-schedule`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ date: today })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult(`✅ Generated ${result.hourly_schedule.length}h schedule with ${result.productivity_score}% productivity!`, 'success');
                    showResult(`🤖 AI created ${result.ai_generated_slots} optimized time slots`, 'info');
                } else {
                    showResult('❌ Failed to generate schedule', 'error');
                }
            } catch (error) {
                console.error('Hourly schedule error:', error);
                showResult(`❌ Error: ${error.message}`, 'error');
            }
        }
        
        async function optimizeWeek() {
            showResult('📊 Analyzing and optimizing your week...', 'info');
            
            try {
                const today = new Date();
                const monday = new Date(today.getFullYear(), today.getMonth(), today.getDate() - today.getDay() + 1);
                const weekStart = monday.toISOString().split('T')[0];
                
                const response = await fetch(`${backendUrl}/api/ai-calendar/weekly-optimize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ week_start_date: weekStart })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const goalPercentage = result.current_analysis.goal_percentage.toFixed(1);
                    showResult(`✅ Week analyzed! ${goalPercentage}% goal-focused time`, 'success');
                    showResult(`💡 Found ${result.optimization_suggestions?.length || 0} optimization opportunities`, 'info');
                } else {
                    showResult('❌ Failed to optimize week', 'error');
                }
            } catch (error) {
                console.error('Weekly optimization error:', error);
                showResult(`❌ Error: ${error.message}`, 'error');
            }
        }
        
        async function scheduleGoalTime() {
            showResult('🎯 Auto-scheduling time blocks for your goals...', 'info');
            
            try {
                const response = await fetch(`${backendUrl}/api/ai-calendar/bulk-schedule-from-goals?days_ahead=7`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showResult(`✅ Scheduled ${result.scheduled_events.length} goal sessions across ${result.goals_processed} goals`, 'success');
                } else {
                    showResult(`ℹ️ ${result.message || 'No goals to schedule'}`, 'info');
                }
            } catch (error) {
                console.error('Goal scheduling error:', error);
                showResult(`❌ Error: ${error.message}`, 'error');
            }
        }
        
        // Utility Functions
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('ai-results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            
            resultsDiv.innerHTML += `<p class="${className}">[${timestamp}] ${message}</p>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
            
            // Also show as toast
            showToast(message, type);
        }
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 4000);
        }
        
        // Enter key handling
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.id === 'messageInput') {
                e.preventDefault();
                sendMessage();
            }
        });
        
        console.log('🎯 Aurora Life OS ready! Try clicking the buttons.');
    </script>
</body>
</html>